<!DOCTYPE html>
<html>
<head>
  <title>My HTML Page</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
  <style>
    body {
      margin: 0;
      height: 5000px;
    }
    canvas {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
    <script>
      const winState = {
        totalScrollRange: document.documentElement.scrollHeight - window.innerHeight,
        scaleScrollRange: 0,
        rotationScrollRange: 0,
        scrollY: 0,
        mouseX: 0,
        mouseY: 0,
        width: window.innerWidth,
        height: window.innerHeight
      }
      // Create a scene
      const scene = new THREE.Scene();

      // Create a camera
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 5;

      // Create a renderer
      const renderer = new THREE.WebGLRenderer({
        antialiased: true
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      
      document.body.appendChild(renderer.domElement);
      const sphere = new THREE.Group();
      const ambientLight = new THREE.AmbientLight({intensity: 1})
      const spotLight = new THREE.SpotLight()
      const backLight = new THREE.DirectionalLight()
      spotLight.intensity = 0.5;
      spotLight.color = new THREE.Color(0xff0000);
      spotLight.position.y = 5;
      spotLight.position.x = 5;
      spotLight.position.z = 5;
      
      backLight.intensity = 0.2;
      backLight.position.y = -2;
      backLight.position.x = -11;
      backLight.position.z = -1;

      scene.add(ambientLight)
      scene.add(spotLight)
      scene.add(backLight)

      for (let i = 0; i < 225;i++) {
        // create a taurus
        const geometry = new THREE.SphereGeometry(0.5, 12, 12);
        const r = 255; //Math.floor(Math.random() * 255);
        const g = 95; //Math.floor(Math.random() * 255);
        const material = new THREE.MeshPhysicalMaterial({ 
          color: `rgb(${r},${g},0)`,
          transparent: true,
          opacity: 0.9,
          wireframe: true
        });
        material.metalness = 0.2;
        material.shininess = 0.4;
        const newSphere = new THREE.Mesh(geometry, material);
        newSphere.position.y = (Math.floor(i / 15) - 7) * 0.8;
        newSphere.position.x = i % 15 - 7 + (Math.floor(i / 15) % 2) * 0.5;

        sphere.add(newSphere);
      }
      scene.add(sphere);
      sphere.position.z = -2;

      function handleWheel(e) {
        winState.scrollY += e.deltaY;
        winState.scrollY = Math.min(1200, winState.scrollY);
      }
      
      function handleResize() {
        winState.totalScrollRange = document.documentElement.scrollHeight - window.innerHeight;
        winState.scaleScrollRange = [0, winState.totalScrollRange / 5];
        winState.rotationScrollRange = [winState.scaleScrollRange[1], winState.totalScrollRange / 5];
        winState.width = window.innerWidth;
        winState.height = window.innerHeight;
      }

      function handleMouseMove(e) {
        winState.mouseX = e.clientX / winState.width - 0.5;
        winState.mouseY = -1 * (e.clientY / winState.height - 0.5);
      }

      // Create an animation loop
      function animate() {
        requestAnimationFrame(animate);
        let scaleScrollProgress = Math.min(1, Math.max(0, (document.documentElement.scrollTop - winState.scaleScrollRange[0])) / winState.scaleScrollRange[1]);
        let rotationScrollProgress = Math.min(1, Math.max(0, (document.documentElement.scrollTop - winState.rotationScrollRange[0])) / winState.rotationScrollRange[1]);

        // sphere.rotation.y += 0.01;
        sphere.children.forEach((child, i) => {
          const distance = Math.sqrt(
            Math.pow(winState.mouseX * 8 - child.position.x, 2) +
            Math.pow(winState.mouseY * 8 - child.position.y, 2)
          ) * (scrollY / 1400 + 0.4);
          child.position.z += 0.05 * (distance - child.position.z);
          child.rotation.y += 0.01;
          child.rotation.z += 0.01;
          child.rotation.x += 0.01;
        })
        sphere.position.z = -2 + scrollY * 0.001
        
        // Render the scene
        renderer.render(scene, camera);
      }

      // Start the animation loop
      handleResize();
      animate();

      window.addEventListener("resize", handleResize);
      window.addEventListener("mousemove", handleMouseMove);
      window.addEventListener("wheel", handleWheel);
      
    </script>
</body>
</html>
